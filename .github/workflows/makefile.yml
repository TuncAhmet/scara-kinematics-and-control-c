name: CI (Windows)

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  c-build-and-test:
    name: C build + Unity tests (Make)
    runs-on: windows-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup MSYS2 (MinGW64 toolchain)
        uses: msys2/setup-msys2@v2
        with:
          msystem: MINGW64
          update: true
          install: >-
            mingw-w64-x86_64-gcc
            mingw-w64-x86_64-make

      - name: Build
        shell: cmd
        run: |
          set PATH=C:\msys64\mingw64\bin;%PATH%
          mingw32-make SHELL=cmd.exe

      - name: Test
        shell: cmd
        run: |
          set PATH=C:\msys64\mingw64\bin;%PATH%
          mingw32-make test SHELL=cmd.exe

  python-ui-smoke:
    name: Python UI smoke check
    runs-on: windows-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"
          cache: "pip"
          cache-dependency-path: python_ui/requirements.txt

      - name: Install UI dependencies
        run: |
          python -m pip install --upgrade pip
          python -m pip install -r python_ui/requirements.txt

      - name: Syntax/import smoke check
        run: |
          python -m compileall python_ui
